// Translations for Minigames Page 
const translations = { 
fr: { 
menu: "Menu", 
produit: "Produit", 
games: "Mini Jeux", 
history: "Histoire", 
contact: "Contact", 
profile: "Profil", 
logout: "Déconnexion", 
gamesTitle: "Mini Jeux Indumilk", 
profileName: "Nom: Utilisateur Invité", 
profileEmail: "Email: guest@indumilk.com", 
profileMember: "Membre depuis: 2024", 
orderHistoryTitle: "Historique des commandes", 
orderHistoryEmpty: "Aucune commande récente", 
logoutSuccess: "Déconnexion réussie!", 
logoutConfirm: "Êtes-vous sûr de vouloir vous déconnecter?", 
logoutInProgress: "Déconnexion en cours...", 
scoreLabel: "Score:", 
bestLabel: "Meilleur:", 
memoryGameTitle: "Jeu de Mémoire", 
memoryGameDesc: "Mémorisez les produits et trouvez les paires!", 
quizGameTitle: "Quiz Produits", 
quizGameDesc: "Testez vos connaissances sur nos produits!", 
matchingGameTitle: "Association", 
matchingGameDesc: "Associez les produits à leurs descriptions!", 
memoryTitle: "Jeu de Mémoire", 
memoryInstructions: "Mémorisez les positions des produits, puis trouvez les paires!", 
quizTitle: "Quiz Produits", 
quizInstructions: "Répondez correctement aux questions sur nos produits!", 
matchingTitle: "Jeu d'Association", 
matchingInstructions: "Glissez les produits vers leurs descriptions correspondantes!", 
startGame: "Commencer", 
startQuiz: "Commencer Quiz", 
startMatching: "Commencer Association", 
reset: "Recommencer", 
playAgain: "Rejouer", 
close: "Fermer", 
congratulations: "🎉 Félicitations! 🎉", 
gameCompleted: "Vous avez terminé le jeu avec succès!", 
finalScore: "Score Final:", 
timeBonus: "Bonus Temps: +", 
couponEarned: "Vous avez gagné un coupon de réduction!", 
couponDescription: "Réduction sur un produit de votre choix", 
applyToCart: "Appliquer au Panier", 
couponApplied: "Coupon appliqué au panier!", 
couponAlreadyUsed: "Ce coupon a déjà été utilisé!", 
excellent: "Excellente paire! +100 points!", 
tryAgain: "Pas de chance... -10 points", 
speedBonus: "Bonus de vitesse:", 
newRecord: "Nouveau record!", 
gameInProgress: "Jeu en cours...", 
memorize: "Mémorisez les positions des produits... ⏰", 
findPairs: "Trouvez les paires! Bonne chance! 🎯", 
gameFinished: "Jeu terminé! Score final:", 
clickStart: "Cliquez sur 'Commencer' pour jouer!", 
questionCounter: "Question", 
products: "Produits", 
descriptions: "Descriptions" 
}, 
en: { 
menu: "Menu", 
produit: "Products", 
games: "Mini Games", 
history: "History", 
contact: "Contact", 
profile: "Profile", 
logout: "Logout", 
gamesTitle: "Indumilk Mini Games", 
profileName: "Name: Guest User", 
profileEmail: "Email: guest@indumilk.com", 
profileMember: "Member since: 2024", 
orderHistoryTitle: "Order History", 
orderHistoryEmpty: "No recent orders", 
logoutSuccess: "Logout successful!", 
logoutConfirm: "Are you sure you want to logout?", 
logoutInProgress: "Logging out...", 
scoreLabel: "Score:", 
bestLabel: "Best:", 
memoryGameTitle: "Memory Game", 
memoryGameDesc: "Memorize products and find pairs!", 
quizGameTitle: "Product Quiz", 
quizGameDesc: "Test your knowledge about our products!", 
matchingGameTitle: "Matching Game", 
matchingGameDesc: "Match products with their descriptions!", 
memoryTitle: "Memory Game", 
memoryInstructions: "Memorize product positions, then find the pairs!", 
quizTitle: "Product Quiz", 
quizInstructions: "Answer questions correctly about our products!", 
matchingTitle: "Matching Game", 
matchingInstructions: "Drag products to their corresponding descriptions!", 
startGame: "Start Game", 
startQuiz: "Start Quiz", 
startMatching: "Start Matching", 
reset: "Reset", 
playAgain: "Play Again", 
close: "Close", 
congratulations: "🎉 Congratulations! 🎉", 
gameCompleted: "You have completed the game successfully!", 
finalScore: "Final Score:", 
timeBonus: "Time Bonus: +", 
couponEarned: "You've earned a discount coupon!", 
couponDescription: "Discount on any product of your choice", 
applyToCart: "Apply to Cart", 
couponApplied: "Coupon applied to cart!", 
couponAlreadyUsed: "This coupon has already been used!", 
excellent: "Excellent pair! +100 points!", 
tryAgain: "No luck... -10 points", 
speedBonus: "Speed bonus:", 
newRecord: "New record!", 
gameInProgress: "Game in progress...", 
memorize: "Memorize product positions... ⏰", 
findPairs: "Find the pairs! Good luck! 🎯", 
gameFinished: "Game finished! Final score:", 
clickStart: "Click 'Start Game' to play!", 
questionCounter: "Question", 
products: "Products", 
descriptions: "Descriptions" 
}, 
ar: { 
menu: "القائمة", 
produit: "المنتجات", 
games: "ألعاب مصغرة", 
history: "التاريخ", 
contact: "اتصل", 
profile: "الملف الشخصي", 
logout: "تسجيل خروج", 
gamesTitle: "ألعاب إندوميلك المصغرة", 
profileName: "الاسم: مستخدم ضيف", 
profileEmail: "البريد الإلكتروني: guest@indumilk.com", 
profileMember: "عضو منذ: 2024", 
orderHistoryTitle: "تاريخ الطلبات", 
orderHistoryEmpty: "لا توجد طلبات حديثة", 
logoutSuccess: "تم تسجيل الخروج بنجاح!", 
logoutConfirm: "هل أنت متأكد من أنك تريد تسجيل الخروج؟", 
logoutInProgress: "جاري تسجيل الخروج...", 
scoreLabel: "النقاط:", 
bestLabel: "الأفضل:", 
memoryGameTitle: "لعبة الذاكرة", 
memoryGameDesc: "احفظ المنتجات وجد الأزواج!", 
quizGameTitle: "مسابقة المنتجات", 
quizGameDesc: "اختبر معرفتك بمنتجاتنا!", 
matchingGameTitle: "لعبة المطابقة", 
matchingGameDesc: "اربط المنتجات بأوصافها!", 
memoryTitle: "لعبة الذاكرة", 
memoryInstructions: "احفظ مواقع المنتجات، ثم جد الأزواج!", 
quizTitle: "مسابقة المنتجات", 
quizInstructions: "أجب بصحة على الأسئلة حول منتجاتنا!", 
matchingTitle: "لعبة المطابقة", 
matchingInstructions: "اسحب المنتجات إلى أوصافها المطابقة!", 
startGame: "ابدأ اللعب", 
startQuiz: "ابدأ المسابقة", 
startMatching: "ابدأ المطابقة", 
reset: "إعادة تشغيل", 
playAgain: "العب مرة أخرى", 
close: "إغلاق", 
congratulations: "🎉 تهانينا! 🎉", 
gameCompleted: "لقد أكملت اللعبة بنجاح!", 
finalScore: "النقاط النهائية:", 
timeBonus: "مكافأة الوقت: +", 
couponEarned: "لقد ربحت كوبون خصم!", 
couponDescription: "خصم على أي منتج من اختيارك", 
applyToCart: "تطبيق على السلة", 
couponApplied: "تم تطبيق الكوبون على السلة!", 
couponAlreadyUsed: "تم استخدام هذا الكوبون بالفعل!", 
excellent: "زوج ممتاز! +100 نقطة!", 
tryAgain: "لا حظ... -10 نقاط", 
speedBonus: "مكافأة السرعة:", 
newRecord: "رقم قياسي جديد!", 
gameInProgress: "اللعبة قيد التشغيل...", 
memorize: "احفظ مواقع المنتجات... ⏰", 
findPairs: "جد الأزواج! حظ سعيد! 🎯", 
gameFinished: "انتهت اللعبة! النقاط النهائية:", 
clickStart: "انقر 'ابدأ اللعب' للعب!", 
questionCounter: "سؤال", 
products: "المنتجات", 
descriptions: "الأوصاف" 
} 
}; 

// Product data for games - Using emojis for memory game
const products = [ 
{ 
id: 1, 
name: { 
fr: "Lait Frais Premium", 
en: "Premium Fresh Milk", 
ar: "حليب طازج فاخر" 
}, 
description: { 
fr: "Lait frais de qualité supérieure, riche en vitamines", 
en: "Premium fresh milk, rich in vitamins", 
ar: "حليب طازج عالي الجودة، غني بالفيتامينات" 
}, 
symbol: '🥛', 
emoji: '🥛'
}, 
{ 
id: 2, 
name: { 
fr: "Mozzarella Artisanale", 
en: "Artisan Mozzarella", 
ar: "موتزاريلا حرفية" 
}, 
description: { 
fr: "Mozzarella traditionnelle faite à la main", 
en: "Traditional handmade mozzarella", 
ar: "موتزاريلا تقليدية مصنوعة يدوياً" 
}, 
symbol: '🧀', 
emoji: '🧀'
}, 
{ 
id: 3, 
name: { 
fr: "Crème Fraîche Premium", 
en: "Premium Fresh Cream", 
ar: "كريمة طازجة فاخرة" 
}, 
description: { 
fr: "Crème fraîche onctueuse pour vos préparations", 
en: "Smooth fresh cream for your preparations", 
ar: "كريمة طازجة ناعمة لتحضيراتك" 
}, 
symbol: '🍦', 
emoji: '🍦'
}, 
{ 
id: 4, 
name: { 
fr: "Beurre Fermier", 
en: "Farm Butter", 
ar: "زبدة المزرعة" 
}, 
description: { 
fr: "Beurre artisanal fait à partir de crème fraîche", 
en: "Artisan butter made from fresh cream", 
ar: "زبدة حرفية مصنوعة من الكريمة الطازجة" 
}, 
symbol: '🧈', 
emoji: '🧈'
}, 
{ 
id: 5, 
name: { 
fr: "Yaourt Nature Bio", 
en: "Organic Natural Yogurt", 
ar: "زبادي طبيعي عضوي" 
}, 
description: { 
fr: "Yaourt nature biologique sans additifs", 
en: "Organic natural yogurt without additives", 
ar: "زبادي طبيعي عضوي بدون إضافات" 
}, 
symbol: '🥛', 
emoji: '🍯'
}, 
{ 
id: 6, 
name: { 
fr: "Ricotta Délicate", 
en: "Delicate Ricotta", 
ar: "ريكوتا رقيقة" 
}, 
description: { 
fr: "Ricotta légère et crémeuse", 
en: "Light and creamy ricotta", 
ar: "ريكوتا خفيفة وكريمية" 
}, 
symbol: '🥧', 
emoji: '🍰'
}, 
{ 
id: 7, 
name: { 
fr: "Fromage Edam", 
en: "Edam Cheese", 
ar: "جبن إيدام" 
}, 
description: { 
fr: "Fromage Edam vieilli selon les méthodes traditionnelles", 
en: "Edam cheese aged according to traditional methods", 
ar: "جبن إيدام معتق وفقاً للطرق التقليدية" 
}, 
symbol: '🍪', 
emoji: '🥨'
}, 
{ 
id: 8, 
name: { 
fr: "Camembert Premium", 
en: "Premium Camembert", 
ar: "كامامبير فاخر" 
}, 
description: { 
fr: "Camembert authentique avec sa croûte fleurie", 
en: "Authentic camembert with its bloomy rind", 
ar: "كامامبير أصيل بقشرته المزهرة" 
}, 
symbol: '🥨', 
emoji: '🧀'
} 
]; 

// Quiz questions data
const quizQuestions = [ 
{ 
question: { 
fr: "Quel produit est le plus riche en calcium?", 
en: "Which product is richest in calcium?", 
ar: "أي منتج هو الأغنى بالكالسيوم؟" 
}, 
answers: [ 
{ 
fr: "Lait Frais", 
en: "Fresh Milk", 
ar: "الحليب الطازج" 
}, 
{ 
fr: "Yaourt", 
en: "Yogurt", 
ar: "الزبادي" 
}, 
{ 
fr: "Beurre", 
en: "Butter", 
ar: "الزبدة" 
}, 
{ 
fr: "Crème", 
en: "Cream", 
ar: "الكريمة" 
} 
], 
correct: 0 
}, 
{ 
question: { 
fr: "Combien de temps peut-on conserver le lait frais au réfrigérateur?", 
en: "How long can fresh milk be stored in the refrigerator?", 
ar: "كم من الوقت يمكن حفظ الحليب الطازج في الثلاجة؟" 
}, 
answers: [ 
{ 
fr: "3-5 jours", 
en: "3-5 days", 
ar: "3-5 أيام" 
}, 
{ 
fr: "7-10 jours", 
en: "7-10 days", 
ar: "7-10 أيام" 
}, 
{ 
fr: "2 semaines", 
en: "2 weeks", 
ar: "أسبوعين" 
}, 
{ 
fr: "1 mois", 
en: "1 month", 
ar: "شهر واحد" 
} 
], 
correct: 1 
}, 
{ 
question: { 
fr: "Quel fromage est originaire des Pays-Bas?", 
en: "Which cheese originates from the Netherlands?", 
ar: "أي جبن نشأ في هولندا؟" 
}, 
answers: [ 
{ 
fr: "Mozzarella", 
en: "Mozzarella", 
ar: "موتزاريلا" 
}, 
{ 
fr: "Camembert", 
en: "Camembert", 
ar: "كامامبير" 
}, 
{ 
fr: "Edam", 
en: "Edam", 
ar: "إيدام" 
}, 
{ 
fr: "Ricotta", 
en: "Ricotta", 
ar: "ريكوتا" 
} 
], 
correct: 2 
}, 
{ 
question: { 
fr: "Que contiennent principalement les yaourts bio?", 
en: "What do organic yogurts mainly contain?", 
ar: "ماذا يحتوي الزبادي العضوي بشكل أساسي؟" 
}, 
answers: [ 
{ 
fr: "Additifs chimiques", 
en: "Chemical additives", 
ar: "إضافات كيميائية" 
}, 
{ 
fr: "Probiotiques naturels", 
en: "Natural probiotics", 
ar: "البروبيوتيك الطبيعي" 
}, 
{ 
fr: "Colorants artificiels", 
en: "Artificial colors", 
ar: "ألوان صناعية" 
}, 
{ 
fr: "Conservateurs", 
en: "Preservatives", 
ar: "مواد حافظة" 
} 
], 
correct: 1 
}, 
{ 
question: { 
fr: "À quelle température doit-on conserver la crème fraîche?", 
en: "At what temperature should fresh cream be stored?", 
ar: "في أي درجة حرارة يجب حفظ الكريمة الطازجة؟" 
}, 
answers: [ 
{ 
fr: "Température ambiante", 
en: "Room temperature", 
ar: "درجة حرارة الغرفة" 
}, 
{ 
fr: "0-4°C", 
en: "0-4°C", 
ar: "0-4 درجة مئوية" 
}, 
{ 
fr: "-18°C", 
en: "-18°C", 
ar: "-18 درجة مئوية" 
}, 
{ 
fr: "10-15°C", 
en: "10-15°C", 
ar: "10-15 درجة مئوية" 
} 
], 
correct: 1 
} 
]; 

// Game state variables
let currentLang = 'fr'; 
let isDarkMode = false; 
let currentGame = 'memory'; 

// Memory game variables
let memoryCards = []; 
let flippedCards = []; 
let matchedPairs = 0; 
let memoryScore = 0; 
let memoryBestScore = 0; 
let gameActive = false; 
let gamePhase = 'waiting'; 
let previewTimer = null; 
let gameStartTime = 0; 

// Quiz game variables
let currentQuestionIndex = 0; 
let quizScore = 0; 
let quizBestScore = 0; 
let quizActive = false; 
let selectedAnswer = null; 

// Matching game variables
let matchingScore = 0; 
let matchingBestScore = 0; 
let matchingActive = false; 
let draggedItem = null; 
let correctMatches = 0; 

// Adds CSS styles to make game text gray and glowing, plus black backgrounds for quiz options
function addGlowEffectStyles() { 
const style = document.createElement('style'); 
style.id = 'game-glow-styles'; 
// Avoid adding styles more than once 
if (document.getElementById(style.id)) return; 

style.textContent = `
/* Glowing gray text effect for game elements */ 
.gameArea .card-name, 
#questionText, 
.answerOption, 
.draggableItem, 
.dropZone, 
.gameStatus { 
color: #888; /* A mid-gray */ 
text-shadow: 0 0 7px #ccc; /* A light glow */ 
} 

/* Black background for quiz answer options */
.answerOption {
background-color: #000 !important;
border: 1px solid #333;
border-radius: 8px;
padding: 12px 16px;
margin: 8px 0;
transition: all 0.3s ease;
}

.answerOption:hover {
background-color: #222 !important;
border-color: #555;
}

.answerOption.selected {
background-color: #333 !important;
border-color: #666;
}

.answerOption.correct {
background-color: #006400 !important;
border-color: #008000;
}

.answerOption.incorrect {
background-color: #8B0000 !important;
border-color: #FF0000;
}

/* Adjust glow for dark mode for better visibility */ 
.dark-mode .gameArea .card-name, 
.dark-mode #questionText, 
.dark-mode .answerOption, 
.dark-mode .draggableItem, 
.dark-mode .dropZone, 
.dark-mode .gameStatus { 
color: #ccc; /* Lighter gray for dark backgrounds */ 
text-shadow: 0 0 8px #555; /* Darker glow */ 
} 

/* Dark mode quiz options */
.dark-mode .answerOption {
background-color: #000 !important;
border-color: #444;
}

.dark-mode .answerOption:hover {
background-color: #111 !important;
border-color: #666;
}
`; 
document.head.appendChild(style); 
} 

// Initialize the application
function init() { 
addGlowEffectStyles(); 
loadSettings(); 
updateLanguage(); 
setupEventListeners(); 
updateScoreDisplay(); 
showGame(currentGame); 
} 

// Load saved settings
function loadSettings() { 
const savedLang = localStorage.getItem('selectedLanguage'); 
if (savedLang && translations[savedLang]) { 
currentLang = savedLang; 
} 

const savedDarkMode = localStorage.getItem('darkMode'); 
if (savedDarkMode === 'enabled') { 
isDarkMode = true; 
document.body.classList.add('dark-mode'); 
const toggle = document.getElementById('darkModeToggle'); 
if (toggle) toggle.textContent = '☀️'; 
} 

// Load best scores with fallback
memoryBestScore = parseInt(localStorage.getItem('memoryBestScore')) || 0; 
quizBestScore = parseInt(localStorage.getItem('quizBestScore')) || 0; 
matchingBestScore = parseInt(localStorage.getItem('matchingBestScore')) || 0; 

// Update cart count if exists
const cartCount = document.getElementById('cartCount'); 
if (cartCount) { 
const savedCart = localStorage.getItem('cart'); 
if (savedCart) { 
const cart = JSON.parse(savedCart); 
const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0); 
cartCount.textContent = totalItems; 
} 
} 
} 

// Setup event listeners
function setupEventListeners() { 
// Game selection cards
document.querySelectorAll('.gameCard').forEach(card => { 
card.addEventListener('click', () => { 
const gameType = card.dataset.game; 
showGame(gameType); 
}); 
}); 

// Memory game buttons
const memoryStart = document.getElementById('memoryStart'); 
if (memoryStart) { 
memoryStart.addEventListener('click', startMemoryGame); 
} 

// Quiz game buttons
const quizStart = document.getElementById('quizStart'); 
if (quizStart) { 
quizStart.addEventListener('click', startQuizGame); 
} 

// Matching game buttons
const matchingStart = document.getElementById('matchingStart'); 
if (matchingStart) { 
matchingStart.addEventListener('click', startMatchingGame); 
} 

// Modal close events
const successModal = document.getElementById('successModal'); 
if (successModal) { 
successModal.addEventListener('click', (e) => { 
if (e.target === successModal) { 
closeSuccessModal(); 
} 
}); 
} 

// Keyboard events
document.addEventListener('keydown', handleKeyboardEvents); 
} 

// Show selected game
function showGame(gameType) { 
// Update active game card
document.querySelectorAll('.gameCard').forEach(card => { 
card.classList.remove('active'); 
if (card.dataset.game === gameType) { 
card.classList.add('active'); 
} 
}); 

// Hide all game areas
document.querySelectorAll('.gameArea').forEach(area => { 
area.classList.add('hidden'); 
}); 

// Show selected game area
const gameArea = document.getElementById(gameType + 'GameArea'); 
if (gameArea) { 
gameArea.classList.remove('hidden'); 
currentGame = gameType; 
updateScoreDisplay(); 
} 
} 

// Update score display based on current game
function updateScoreDisplay() { 
let currentScore = 0; 
let bestScore = 0; 

switch(currentGame) { 
case 'memory': 
currentScore = memoryScore; 
bestScore = memoryBestScore; 
break; 
case 'quiz': 
currentScore = quizScore; 
bestScore = quizBestScore; 
break; 
case 'matching': 
currentScore = matchingScore; 
bestScore = matchingBestScore; 
break; 
} 

const currentScoreEl = document.getElementById('currentScore'); 
const bestScoreEl = document.getElementById('bestScore'); 
if (currentScoreEl) currentScoreEl.textContent = currentScore; 
if (bestScoreEl) bestScoreEl.textContent = bestScore; 
} 

// MEMORY GAME FUNCTIONS
function startMemoryGame() { 
gamePhase = 'preview'; 
gameActive = false; 
flippedCards = []; 
matchedPairs = 0; 
memoryScore = 0; 
gameStartTime = Date.now(); 

const startBtn = document.getElementById('memoryStart'); 
if (startBtn) { 
startBtn.disabled = true; 
startBtn.textContent = translations[currentLang].gameInProgress; 
} 

initializeMemoryCards(); 
showAllMemoryCards(); 
updateGameStatus(translations[currentLang].memorize, 'preview'); 
updateScoreDisplay(); 

previewTimer = setTimeout(() => { 
hideAllMemoryCards(); 
gamePhase = 'playing'; 
gameActive = true; 
updateGameStatus(translations[currentLang].findPairs, 'playing'); 
}, 4000); 
} 

function initializeMemoryCards() { 
const cardPairs = [...products.slice(0, 8), ...products.slice(0, 8)]; 

// Shuffle cards
for (let i = cardPairs.length - 1; i > 0; i--) { 
const j = Math.floor(Math.random() * (i + 1)); 
[cardPairs[i], cardPairs[j]] = [cardPairs[j], cardPairs[i]]; 
} 

memoryCards = cardPairs.map((product, index) => ({ 
id: index, 
productId: product.id, 
symbol: product.symbol, 
emoji: product.emoji, // Use emoji instead of images
name: product.name[currentLang], 
isFlipped: false, 
isMatched: false 
})); 

renderMemoryCards(); 
} 

function renderMemoryCards() { 
const grid = document.getElementById('memoryGrid'); 
if (!grid) return; 

grid.innerHTML = ''; 
memoryCards.forEach((card, index) => { 
const cardElement = document.createElement('div'); 
cardElement.className = `memoryCard ${card.isFlipped ? 'flipped' : ''} ${card.isMatched ? 'matched' : ''}`; 

if (card.isFlipped || card.isMatched) { 
cardElement.innerHTML = `
<div class="card-content"> 
<span class="card-emoji" style="font-size: 3rem; display: block; margin-bottom: 8px;">${card.emoji}</span>
<span class="card-name">${card.name}</span> 
</div> 
`; 
} else { 
cardElement.innerHTML = '<span class="card-back">❓</span>'; 
} 

cardElement.addEventListener('click', () => handleMemoryCardClick(index)); 
grid.appendChild(cardElement); 
}); 
} 

function showAllMemoryCards() { 
memoryCards.forEach(card => { 
card.isFlipped = true; 
}); 
renderMemoryCards(); 
} 

function hideAllMemoryCards() { 
memoryCards.forEach(card => { 
if (!card.isMatched) { 
card.isFlipped = false; 
} 
}); 
renderMemoryCards(); 
} 

function handleMemoryCardClick(index) { 
if (!gameActive || gamePhase !== 'playing') return; 
if (memoryCards[index].isFlipped || memoryCards[index].isMatched) return; 
if (flippedCards.length >= 2) return; 

memoryCards[index].isFlipped = true; 
flippedCards.push(index); 
renderMemoryCards(); 

if (flippedCards.length === 2) { 
setTimeout(checkMemoryMatch, 1000); 
} 
} 

function checkMemoryMatch() { 
const [firstIndex, secondIndex] = flippedCards; 
const firstCard = memoryCards[firstIndex]; 
const secondCard = memoryCards[secondIndex]; 

if (firstCard.productId === secondCard.productId) { 
firstCard.isMatched = true; 
secondCard.isMatched = true; 
matchedPairs++; 
memoryScore += 100; 
showNotification(translations[currentLang].excellent, 'success'); 

if (matchedPairs === 8) { 
setTimeout(finishMemoryGame, 500); 
} 
} else { 
firstCard.isFlipped = false; 
secondCard.isFlipped = false; 
memoryScore = Math.max(0, memoryScore - 10); 
showNotification(translations[currentLang].tryAgain, 'warning'); 
} 

flippedCards = []; 
updateScoreDisplay(); 
renderMemoryCards(); 
} 

function finishMemoryGame() { 
gameActive = false; 
gamePhase = 'finished'; 
clearTimeout(previewTimer); 

const gameTime = (Date.now() - gameStartTime) / 1000; 
const timeBonus = Math.max(0, Math.round((120 - gameTime) * 5)); 
memoryScore += timeBonus; 

if (timeBonus > 0) { 
showNotification(`${translations[currentLang].speedBonus} +${timeBonus}`, 'success'); 
} 

if (memoryScore > memoryBestScore) { 
memoryBestScore = memoryScore; 
localStorage.setItem('memoryBestScore', memoryBestScore); 
showNotification(`${translations[currentLang].newRecord} ${memoryScore}`, 'success'); 
} 

updateScoreDisplay(); 
updateGameStatus(`${translations[currentLang].gameFinished} ${memoryScore}`, 'finished'); 
setTimeout(() => showSuccessModal('memory', memoryScore, timeBonus), 1000); 

const startBtn = document.getElementById('memoryStart'); 
if (startBtn) { 
startBtn.disabled = false; 
startBtn.textContent = translations[currentLang].playAgain; 
} 
} 

function resetMemoryGame() { 
gameActive = false; 
gamePhase = 'waiting'; 
clearTimeout(previewTimer); 
flippedCards = []; 
matchedPairs = 0; 
memoryScore = 0; 

const startBtn = document.getElementById('memoryStart'); 
if (startBtn) { 
startBtn.disabled = false; 
startBtn.textContent = translations[currentLang].startGame; 
} 

updateScoreDisplay(); 
updateGameStatus(translations[currentLang].clickStart, 'waiting'); 

const grid = document.getElementById('memoryGrid'); 
if (grid) grid.innerHTML = ''; 
} 

// QUIZ GAME FUNCTIONS
function startQuizGame() { 
currentQuestionIndex = 0; 
quizScore = 0; 
quizActive = true; 
selectedAnswer = null; 

const startBtn = document.getElementById('quizStart'); 
if (startBtn) { 
startBtn.disabled = true; 
startBtn.textContent = translations[currentLang].gameInProgress; 
} 

updateScoreDisplay(); 
showQuizQuestion(); 
} 

function showQuizQuestion() { 
if (currentQuestionIndex >= quizQuestions.length) { 
finishQuizGame(); 
return; 
} 

const question = quizQuestions[currentQuestionIndex]; 
const questionText = document.getElementById('questionText'); 
if (questionText) { 
questionText.textContent = question.question[currentLang]; 
} 

const optionsContainer = document.getElementById('answerOptions'); 
if (optionsContainer) { 
optionsContainer.innerHTML = ''; 
question.answers.forEach((answer, index) => { 
const optionElement = document.createElement('div'); 
optionElement.className = 'answerOption'; 
optionElement.textContent = answer[currentLang]; 
optionElement.addEventListener('click', () => selectAnswer(index)); 
optionsContainer.appendChild(optionElement); 
}); 
} 

// Update progress
const progressFill = document.getElementById('progressFill'); 
if (progressFill) { 
const progress = ((currentQuestionIndex + 1) / quizQuestions.length) * 100; 
progressFill.style.width = `${progress}%`; 
} 

const questionCounter = document.getElementById('questionCounter'); 
if (questionCounter) { 
questionCounter.textContent = `${translations[currentLang].questionCounter} ${currentQuestionIndex + 1}/${quizQuestions.length}`; 
} 
} 

function selectAnswer(answerIndex) { 
if (selectedAnswer !== null) return; 
selectedAnswer = answerIndex; 

const question = quizQuestions[currentQuestionIndex]; 
const options = document.querySelectorAll('.answerOption'); 

if (options[answerIndex]) { 
options[answerIndex].classList.add('selected'); 
} 

setTimeout(() => { 
options.forEach((option, index) => { 
if (index === question.correct) { 
option.classList.add('correct'); 
} else if (index === answerIndex && index !== question.correct) { 
option.classList.add('incorrect'); 
} 
}); 

if (answerIndex === question.correct) { 
quizScore += 20; 
showNotification('+20 points!', 'success'); 
} else { 
showNotification('Mauvaise réponse!', 'warning'); 
} 

updateScoreDisplay(); 

setTimeout(() => { 
currentQuestionIndex++; 
selectedAnswer = null; 
showQuizQuestion(); 
}, 2000); 
}, 500); 
} 

function finishQuizGame() { 
quizActive = false; 

if (quizScore > quizBestScore) { 
quizBestScore = quizScore; 
localStorage.setItem('quizBestScore', quizBestScore); 
showNotification(`${translations[currentLang].newRecord} ${quizScore}`, 'success'); 
} 

updateScoreDisplay(); 
setTimeout(() => showSuccessModal('quiz', quizScore, 0), 1000); 

const startBtn = document.getElementById('quizStart'); 
if (startBtn) { 
startBtn.disabled = false; 
startBtn.textContent = translations[currentLang].playAgain; 
} 
} 

function resetQuizGame() { 
quizActive = false; 
currentQuestionIndex = 0; 
quizScore = 0; 
selectedAnswer = null; 

const startBtn = document.getElementById('quizStart'); 
if (startBtn) { 
startBtn.disabled = false; 
startBtn.textContent = translations[currentLang].startQuiz; 
} 

updateScoreDisplay(); 

const questionText = document.getElementById('questionText'); 
if (questionText) { 
questionText.textContent = translations[currentLang].clickStart; 
} 

const answerOptions = document.getElementById('answerOptions'); 
if (answerOptions) answerOptions.innerHTML = ''; 

const progressFill = document.getElementById('progressFill'); 
if (progressFill) progressFill.style.width = '0%'; 

const questionCounter = document.getElementById('questionCounter'); 
if (questionCounter) { 
questionCounter.textContent = `${translations[currentLang].questionCounter} 1/${quizQuestions.length}`; 
} 
} 

// MATCHING GAME FUNCTIONS
function startMatchingGame() { 
matchingScore = 0; 
matchingActive = true; 
correctMatches = 0; 
draggedItem = null; 

const startBtn = document.getElementById('matchingStart'); 
if (startBtn) { 
startBtn.disabled = true; 
startBtn.textContent = translations[currentLang].gameInProgress; 
} 

updateScoreDisplay(); 
initializeMatchingGame(); 
} 

function initializeMatchingGame() { 
const shuffledProducts = [...products.slice(0, 6)]; 

// Shuffle products
for (let i = shuffledProducts.length - 1; i > 0; i--) { 
const j = Math.floor(Math.random() * (i + 1)); 
[shuffledProducts[i], shuffledProducts[j]] = [shuffledProducts[j], shuffledProducts[i]]; 
} 

// Create draggable items
const itemsContainer = document.getElementById('draggableItems'); 
if (itemsContainer) { 
itemsContainer.innerHTML = ''; 
shuffledProducts.forEach(product => { 
const item = document.createElement('div'); 
item.className = 'draggableItem'; 
item.textContent = product.name[currentLang]; 
item.dataset.productId = product.id; 
item.draggable = true; 
item.addEventListener('dragstart', handleDragStart); 
item.addEventListener('dragend', handleDragEnd); 
itemsContainer.appendChild(item); 
}); 
} 

// Create drop zones with shuffled descriptions
const shuffledDescriptions = [...shuffledProducts]; 
for (let i = shuffledDescriptions.length - 1; i > 0; i--) { 
const j = Math.floor(Math.random() * (i + 1)); 
[shuffledDescriptions[i], shuffledDescriptions[j]] = [shuffledDescriptions[j], shuffledDescriptions[i]]; 
} 

const zonesContainer = document.getElementById('dropZones'); 
if (zonesContainer) { 
zonesContainer.innerHTML = ''; 
shuffledDescriptions.forEach(product => { 
const zone = document.createElement('div'); 
zone.className = 'dropZone'; 
zone.textContent = product.description[currentLang]; 
zone.dataset.productId = product.id; 
zone.dataset.originalText = product.description[currentLang]; 
zone.addEventListener('dragover', handleDragOver); 
zone.addEventListener('drop', handleDrop); 
zone.addEventListener('dragenter', handleDragEnter); 
zone.addEventListener('dragleave', handleDragLeave); 
zonesContainer.appendChild(zone); 
}); 
} 
} 

function handleDragStart(e) { 
draggedItem = e.target; 
e.target.classList.add('dragging'); 
} 

function handleDragEnd(e) { 
e.target.classList.remove('dragging'); 
draggedItem = null; 
} 

function handleDragOver(e) { 
e.preventDefault(); 
} 

function handleDragEnter(e) { 
e.preventDefault(); 
if (!e.target.classList.contains('filled') && !e.target.classList.contains('correct')) { 
e.target.classList.add('dragover'); 
} 
} 

function handleDragLeave(e) { 
e.target.classList.remove('dragover'); 
} 

function handleDrop(e) { 
e.preventDefault(); 
e.target.classList.remove('dragover'); 

if (!draggedItem || e.target.classList.contains('filled')) return; 

const draggedProductId = parseInt(draggedItem.dataset.productId); 
const dropZoneProductId = parseInt(e.target.dataset.productId); 

if (draggedProductId === dropZoneProductId) { 
// Correct match
e.target.classList.add('correct'); 
e.target.textContent = draggedItem.textContent + ' ✓'; 
draggedItem.style.display = 'none'; 
correctMatches++; 
matchingScore += 50; 
showNotification('+50 points!', 'success'); 

if (correctMatches === 6) { 
setTimeout(finishMatchingGame, 500); 
} 
} else { 
// Incorrect match
e.target.classList.add('filled'); 
e.target.textContent = draggedItem.textContent + ' ✗'; 
draggedItem.style.display = 'none'; 
matchingScore = Math.max(0, matchingScore - 20); 
showNotification('-20 points', 'warning'); 

setTimeout(() => { 
e.target.classList.remove('filled'); 
e.target.textContent = e.target.dataset.originalText || products.find(p => p.id === dropZoneProductId).description[currentLang]; 
draggedItem.style.display = 'block'; 
}, 1500); 
} 

updateScoreDisplay(); 
} 

function finishMatchingGame() { 
matchingActive = false; 

if (matchingScore > matchingBestScore) { 
matchingBestScore = matchingScore; 
localStorage.setItem('matchingBestScore', matchingBestScore); 
showNotification(`${translations[currentLang].newRecord} ${matchingScore}`, 'success'); 
} 

updateScoreDisplay(); 
setTimeout(() => showSuccessModal('matching', matchingScore, 0), 1000); 

const startBtn = document.getElementById('matchingStart'); 
if (startBtn) { 
startBtn.disabled = false; 
startBtn.textContent = translations[currentLang].playAgain; 
} 
} 

function resetMatchingGame() { 
matchingActive = false; 
matchingScore = 0; 
correctMatches = 0; 
draggedItem = null; 

const startBtn = document.getElementById('matchingStart'); 
if (startBtn) { 
startBtn.disabled = false; 
startBtn.textContent = translations[currentLang].startMatching; 
} 

updateScoreDisplay(); 

const draggableItems = document.getElementById('draggableItems'); 
if (draggableItems) draggableItems.innerHTML = ''; 

const dropZones = document.getElementById('dropZones'); 
if (dropZones) dropZones.innerHTML = ''; 
} 

// SUCCESS MODAL FUNCTIONS
function showSuccessModal(gameType, finalScore, timeBonus = 0) { 
const modal = document.getElementById('successModal'); 
if (!modal) return; 

const t = translations[currentLang]; 
const successTitle = document.getElementById('successTitle'); 
const successMessage = document.getElementById('successMessage'); 
const finalScoreValue = document.getElementById('finalScoreValue'); 
const timeBonusValue = document.getElementById('timeBonusValue'); 
const timeBonus1 = document.getElementById('timeBonus'); 

if (successTitle) successTitle.textContent = t.congratulations; 
if (successMessage) successMessage.textContent = t.gameCompleted; 
if (finalScoreValue) finalScoreValue.textContent = finalScore; 
if (timeBonusValue) timeBonusValue.textContent = timeBonus; 
if (timeBonus1) { 
timeBonus1.style.display = timeBonus > 0 ? 'block' : 'none'; 
} 

// Generate coupon
const couponCode = gameType.toUpperCase() + Math.floor(Math.random() * 9999).toString().padStart(4, '0'); 
const couponCodeEl = document.getElementById('couponCode'); 
const couponDescription = document.getElementById('couponDescription'); 

if (couponCodeEl) couponCodeEl.textContent = couponCode; 
if (couponDescription) couponDescription.textContent = t.couponDescription; 

// Save coupon data
const couponData = { 
code: couponCode, 
discount: 10, 
gameType: gameType, 
score: finalScore, 
earned: true, 
applied: false, 
timestamp: Date.now() 
}; 

localStorage.setItem(`${gameType}Coupon`, JSON.stringify(couponData)); 
modal.classList.add('show'); 
} 

function applyCouponToCart() { 
const gameType = currentGame; 
const coupon = JSON.parse(localStorage.getItem(`${gameType}Coupon`)); 

if (coupon && !coupon.applied) { 
coupon.applied = true; 
localStorage.setItem(`${gameType}Coupon`, JSON.stringify(coupon)); 
localStorage.setItem('activeCoupon', JSON.stringify(coupon)); 
showNotification(translations[currentLang].couponApplied, 'success'); 
closeSuccessModal(); 
} else if (coupon && coupon.applied) { 
showNotification(translations[currentLang].couponAlreadyUsed, 'warning'); 
} 
} 

function playAgain() { 
closeSuccessModal(); 
switch(currentGame) { 
case 'memory': 
resetMemoryGame(); 
break; 
case 'quiz': 
resetQuizGame(); 
break; 
case 'matching': 
resetMatchingGame(); 
break; 
} 
} 

function closeSuccessModal() { 
const modal = document.getElementById('successModal'); 
if (modal) modal.classList.remove('show'); 
} 

// UTILITY FUNCTIONS
function updateGameStatus(message, type) { 
const statusElement = document.getElementById('gameStatus'); 
if (statusElement) { 
statusElement.textContent = message; 
statusElement.className = `gameStatus ${type}`; 
} 
} 

function showNotification(message, type = 'info') { 
const notification = document.createElement('div'); 
notification.className = `notification ${type}`; 
notification.textContent = message; 
notification.style.cssText = `
position: fixed; 
top: 20px; 
right: 20px; 
background: ${type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : '#17a2b8'}; 
color: ${type === 'warning' ? '#000' : '#fff'}; 
padding: 12px 20px; 
border-radius: 8px; 
box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
z-index: 5000; 
font-weight: bold; 
animation: slideIn 0.3s ease; 
`; 

document.body.appendChild(notification); 

setTimeout(() => { 
notification.style.animation = 'slideOut 0.3s ease'; 
setTimeout(() => { 
if (notification.parentNode) { 
notification.parentNode.removeChild(notification); 
} 
}, 300); 
}, 3000); 
} 

function handleKeyboardEvents(event) { 
if (event.key === 'Escape') { 
closeSuccessModal(); 
} else if (event.key === 'Enter' || event.key === ' ') { 
if (gamePhase === 'waiting') { 
event.preventDefault(); 
switch(currentGame) { 
case 'memory': 
const memoryBtn = document.getElementById('memoryStart'); 
if (memoryBtn && !memoryBtn.disabled) { 
startMemoryGame(); 
} 
break; 
case 'quiz': 
const quizBtn = document.getElementById('quizStart'); 
if (quizBtn && !quizBtn.disabled) { 
startQuizGame(); 
} 
break; 
case 'matching': 
const matchingBtn = document.getElementById('matchingStart'); 
if (matchingBtn && !matchingBtn.disabled) { 
startMatchingGame(); 
} 
break; 
} 
} 
} 
} 

// LANGUAGE AND THEME FUNCTIONS
function toggleLangDropdown() { 
const dropdown = document.getElementById('langDropdown'); 
if (dropdown) dropdown.classList.toggle('show'); 
} 

function setLang(lang) { 
currentLang = lang; 
localStorage.setItem('selectedLanguage', lang); 
updateLanguage(); 
const dropdown = document.getElementById('langDropdown'); 
if (dropdown) dropdown.classList.remove('show'); 
} 

function updateLanguage() { 
const t = translations[currentLang]; 

// Update navigation
const btnMenu = document.getElementById('btn-menu'); 
const btnProduit = document.getElementById('btn-produit'); 
const btnGames = document.getElementById('btn-games'); 
const btnHistory = document.getElementById('btn-history'); 
const btnContact = document.getElementById('btn-contact'); 

if (btnMenu) btnMenu.textContent = t.menu; 
if (btnProduit) btnProduit.textContent = t.produit; 
if (btnGames) btnGames.textContent = t.games; 
if (btnHistory) btnHistory.textContent = t.history; 
if (btnContact) btnContact.textContent = t.contact; 

// Update page title and labels
const gamesTitle = document.getElementById('gamesTitle'); 
const scoreLabel = document.getElementById('scoreLabel'); 
const bestLabel = document.getElementById('bestLabel'); 

if (gamesTitle) gamesTitle.textContent = t.gamesTitle; 
if (scoreLabel) scoreLabel.textContent = t.scoreLabel; 
if (bestLabel) bestLabel.textContent = t.bestLabel; 

// Update profile section
const profileTitle = document.getElementById('profileTitle'); 
const logoutBtn = document.getElementById('logoutBtn'); 

if (profileTitle) profileTitle.textContent = t.profile; 
if (logoutBtn) logoutBtn.textContent = t.logout; 

const profileInfo = document.getElementById('profileInfo'); 
if (profileInfo) { 
profileInfo.innerHTML = `
<p>${t.profileName}</p> 
<p>${t.profileEmail}</p> 
<p>${t.profileMember}</p> 
`; 
} 

const orderHistory = document.getElementById('orderHistory'); 
if (orderHistory) { 
orderHistory.innerHTML = `
<h3>${t.orderHistoryTitle}</h3> 
<p>${t.orderHistoryEmpty}</p> 
`; 
} 

// Update game cards
const memoryGameTitle = document.getElementById('memoryGameTitle'); 
const memoryGameDesc = document.getElementById('memoryGameDesc'); 
const quizGameTitle = document.getElementById('quizGameTitle'); 
const quizGameDesc = document.getElementById('quizGameDesc'); 
const matchingGameTitle = document.getElementById('matchingGameTitle'); 
const matchingGameDesc = document.getElementById('matchingGameDesc'); 

if (memoryGameTitle) memoryGameTitle.textContent = t.memoryGameTitle; 
if (memoryGameDesc) memoryGameDesc.textContent = t.memoryGameDesc; 
if (quizGameTitle) quizGameTitle.textContent = t.quizGameTitle; 
if (quizGameDesc) quizGameDesc.textContent = t.quizGameDesc; 
if (matchingGameTitle) matchingGameTitle.textContent = t.matchingGameTitle; 
if (matchingGameDesc) matchingGameDesc.textContent = t.matchingGameDesc; 

// Update game instructions
const memoryTitle = document.getElementById('memoryTitle'); 
const memoryInstructions = document.getElementById('memoryInstructions'); 
const quizTitle = document.getElementById('quizTitle'); 
const quizInstructions = document.getElementById('quizInstructions'); 
const matchingTitle = document.getElementById('matchingTitle'); 
const matchingInstructions = document.getElementById('matchingInstructions'); 

if (memoryTitle) memoryTitle.textContent = t.memoryTitle; 
if (memoryInstructions) memoryInstructions.textContent = t.memoryInstructions; 
if (quizTitle) quizTitle.textContent = t.quizTitle; 
if (quizInstructions) quizInstructions.textContent = t.quizInstructions; 
if (matchingTitle) matchingTitle.textContent = t.matchingTitle; 
if (matchingInstructions) matchingInstructions.textContent = t.matchingInstructions; 

// Update buttons
const memoryStart = document.getElementById('memoryStart'); 
const quizStart = document.getElementById('quizStart'); 
const matchingStart = document.getElementById('matchingStart'); 

if (memoryStart && !gameActive) memoryStart.textContent = t.startGame; 
if (quizStart && !quizActive) quizStart.textContent = t.startQuiz; 
if (matchingStart && !matchingActive) matchingStart.textContent = t.startMatching; 

// Handle RTL for Arabic
if (currentLang === 'ar') { 
document.body.setAttribute('dir', 'rtl'); 
document.body.style.fontFamily = 'Arial, Tahoma, sans-serif'; 
} else { 
document.body.setAttribute('dir', 'ltr'); 
document.body.style.fontFamily = 'Arial, sans-serif'; 
} 

// Update memory cards if they exist
if (memoryCards.length > 0) { 
memoryCards.forEach(card => { 
const product = products.find(p => p.id === card.productId); 
if (product) { 
card.name = product.name[currentLang]; 
} 
}); 
renderMemoryCards(); 
} 
} 

// Dark mode toggle
function toggleDarkMode() { 
isDarkMode = !isDarkMode; 
document.body.classList.toggle('dark-mode'); 
const toggle = document.getElementById('darkModeToggle'); 
if (toggle) toggle.textContent = isDarkMode ? '☀️' : '🌙'; 
localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled'); 
} 

// Account functions
function showAccount() { 
const accountSlide = document.getElementById('accountSlide'); 
if (accountSlide) accountSlide.classList.add('show'); 
} 

function closeAccount() { 
const accountSlide = document.getElementById('accountSlide'); 
if (accountSlide) accountSlide.classList.remove('show'); 
} 

// UNIFIED LOGOUT FUNCTION - Redirects to authentication page (same as products code)
function logout() { 
const t = translations[currentLang]; 
const logoutBtn = document.getElementById('logoutBtn'); 

// Show confirmation dialog
if (!confirm(t.logoutConfirm)) { 
return; 
} 

// Show loading state
const originalText = logoutBtn.textContent; 
logoutBtn.textContent = t.logoutInProgress; 
logoutBtn.disabled = true; 
logoutBtn.style.opacity = '0.7'; 

// Clear all user-related data
localStorage.removeItem('indumilk_currentUser'); 
localStorage.removeItem('indumilk_session'); 
localStorage.removeItem('indumilk_token'); 
localStorage.removeItem('userPreferences'); 

// Optional: Clear other session data but keep app preferences
// localStorage.removeItem('cart'); 
// localStorage.removeItem('favorites'); 

// Simulate logout process
setTimeout(() => { 
// Show success state briefly
logoutBtn.textContent = t.logoutSuccess; 
logoutBtn.style.backgroundColor = '#4CAF50'; 

// Close account slide
closeAccount(); 

// Clear any timers or intervals
clearTimeout(window.logoutTimer); 

// Redirect to authentication page
setTimeout(() => { 
// Change this to your actual authentication page
window.location.href = 'index.html'; 
}, 800); 
}, 1000); 
} 

// Close dropdowns when clicking outside
document.addEventListener('click', function(event) { 
const langSelect = document.querySelector('.langSelect'); 
const dropdown = document.getElementById('langDropdown'); 

if (langSelect && dropdown && !langSelect.contains(event.target)) { 
dropdown.classList.remove('show'); 
} 
}); 

// Initialize when page loads
document.addEventListener('DOMContentLoaded', init);