<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indumilk Delights - Historique</title>
    <link rel="stylesheet" href="history.css">
</head>
<body>
    <script src="auth-guard.js"></script>
    <script>
        // Immediately-invoked function to prevent FOUC (Flash of Unstyled Content)
        // when switching to dark mode. This script runs before the page is rendered.
        (function() {
            try {
                const theme = localStorage.getItem('theme');
                // If dark mode is stored in localStorage, apply the 'dark-mode' class to the <html> element.
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark-mode');
                }
            } catch (e) {}
        })();
    </script>

    <nav class="navbar">
        <a href="products.html" class="logo" style="display:flex;align-items:center;">
            <img src="Indumilk.png" alt="Indumilk Logo" style="height:58px;vertical-align:middle;">
        </a>
        <div class="navLinks">
            <a id="btn-menu" href="menu.html">Menu</a>
            <a id="btn-produit" href="products.html">Produit</a>
            <a id="btn-games" href="minigame.html">Mini Jeux</a>
            <a id="btn-history" class="active" href="history.html">Histoire</a>
            <a id="btn-stats" href="statistics.html">statistics</a>
            <a id="btn-contact" href="contact.html">Contact</a>
        </div>
        <div class="langSelect">
            <button class="langIcon" onclick="toggleLangDropdown()">🌐</button>
            <div class="langDropdown" id="langDropdown">
                <button onclick="setLang('fr')">Français</button>
                <button onclick="setLang('en')">English</button>
                <button onclick="setLang('ar')">العربية</button>
            </div>
        </div>
        <button class="accountHub" onclick="showAccount()">👤</button>
    </nav>

    <div class="accountSlide" id="accountSlide">
        <button class="closeSlide" onclick="closeAccount()">×</button>
        <h2 id="profileTitle">Profil</h2>
        <div class="profileInfo" id="profileInfo">
            <p>Nom: Utilisateur Invité</p>
            <p>Email: guest@indumilk.com</p>
            <p>Membre depuis: 2024</p>
        </div>
        <div class="orderHistory" id="orderHistory">
            <h3>Historique des commandes</h3>
            <p>Aucune commande récente</p>
        </div>
        <button class="logoutBtn" id="logoutBtn" onclick="logout()">Déconnexion</button>
    </div>

    <!-- History Page Content -->
    <div class="historyContainer">
        <h1 class="historyTitle" id="pageTitle">Historique des Commandes</h1>
        
        <!-- Summary Cards -->
        <div class="summaryCards">
            <div class="summaryCard">
                <div class="cardIcon">📦</div>
                <div class="cardContent">
                    <h3 id="totalOrdersLabel">Total des Commandes</h3>
                    <span class="cardValue" id="totalOrders">0</span>
                </div>
            </div>
            <div class="summaryCard">
                <div class="cardIcon">💰</div>
                <div class="cardContent">
                    <h3 id="totalSpentLabel">Total Dépensé</h3>
                    <span class="cardValue" id="totalSpent">0 DH</span>
                </div>
            </div>
            <div class="summaryCard">
                <div class="cardIcon">⭐</div>
                <div class="cardContent">
                    <h3 id="favoriteItemLabel">Article Préféré</h3>
                    <span class="cardValue" id="favoriteItem">-</span>
                </div>
            </div>
            <div class="summaryCard">
                <div class="cardIcon">📊</div>
                <div class="cardContent">
                    <h3 id="averageOrderLabel">Commande Moyenne</h3>
                    <span class="cardValue" id="averageOrder">0 DH</span>
                </div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filterSection">
            <div class="filterControls">
                <div class="searchContainer">
                    <span class="searchIcon">🔍</span>
                    <input type="text" id="searchInput" class="searchInput" placeholder="Rechercher des commandes...">
                </div>
                <div class="filterGroup">
                    <label for="dateFilter" id="dateFilterLabel">Filtrer par période:</label>
                    <select id="dateFilter">
                        <option value="all">Toutes les périodes</option>
                        <option value="today">Aujourd'hui</option>
                        <option value="thisWeek">Cette semaine</option>
                        <option value="thisMonth">Ce mois</option>
                        <option value="last30Days">30 derniers jours</option>
                        <option value="last90Days">90 derniers jours</option>
                        <option value="thisYear">Cette année</option>
                    </select>
                </div>
                <div class="filterGroup">
                    <label for="statusFilter" id="statusFilterLabel">Filtrer par statut:</label>
                    <select id="statusFilter">
                        <option value="all">Tous les statuts</option>
                        <option value="completed">Terminé</option>
                        <option value="pending">En attente</option>
                        <option value="processing">En cours</option>
                        <option value="shipped">Expédié</option>
                        <option value="delivered">Livré</option>
                        <option value="cancelled">Annulé</option>
                    </select>
                </div>
                <div class="filterGroup">
                    <label for="sortBy" id="sortByLabel">Trier par:</label>
                    <select id="sortBy">
                        <option value="newest">Plus récent</option>
                        <option value="oldest">Plus ancien</option>
                        <option value="highest">Montant le plus élevé</option>
                        <option value="lowest">Montant le plus bas</option>
                    </select>
                </div>
            </div>
            
            <div class="filterActions">
                <button class="clearFiltersBtn" onclick="clearFilters()">
                    <span>🔄</span>
                    <span id="clearFiltersBtn">Effacer les filtres</span>
                </button>
                <button class="exportBtn" onclick="exportOrders()">
                    <span>📥</span>
                    <span id="exportBtn">Exporter</span>
                </button>
                <button class="refreshBtn" onclick="refreshOrders()">
                    <span>🔄</span>
                    <span id="refreshBtn">Actualiser</span>
                </button>
            </div>
            
            <div class="showingResults" id="showingResults">
                Affichage de 0 résultats
            </div>
        </div>

        <!-- Orders List -->
        <div class="ordersSection">
            <h2 id="ordersSectionTitle">Vos Commandes</h2>
            <div class="ordersList" id="ordersList">
                <!-- Orders populated by JavaScript -->
            </div>
            
            <!-- Pagination -->
            <div class="pagination" id="pagination" style="display: none;">
                <!-- Pagination buttons populated by JavaScript -->
            </div>
            
            <div class="noOrders" id="noOrders" style="display: none;">
                <div class="noOrdersIcon">📋</div>
                <h3 id="noOrdersTitle">Aucune commande trouvée</h3>
                <p id="noOrdersText">Vous n'avez pas encore passé de commandes ou aucune commande ne correspond aux filtres sélectionnés.</p>
                <a href="menu.html" class="orderNowBtn" id="orderNowBtn">Commander maintenant</a>
            </div>
        </div>

        <!-- Transaction Details Modal -->
        <div class="transactionModal" id="transactionModal">
            <div class="modalContent">
                <div class="modalHeader">
                    <h2 id="modalTitle">Détails de la Transaction</h2>
                    <button class="closeModal" onclick="closeTransactionModal()">×</button>
                </div>
                <div class="modalBody" id="modalBody">
                    <!-- Transaction details populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Dark Mode Toggle -->
    <button class="darkModeToggle" onclick="toggleDarkMode()" id="darkModeToggle">🌙</button>

    <script src="history.js"></script>
</body>
</html>